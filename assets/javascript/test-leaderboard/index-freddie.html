<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Leaderboard ForEach Way</title>
	<!-- <link rel="stylesheet" type="text/css" href="assets/css/reset.css"> -->
	<!-- <link rel="stylesheet" type="text/css" href="assets/css/style.css"> -->
	<!-- Browser tab icon
	<link rel="icon" type="image/ico" href="assets/images/favicon-marvel.ico"> -->
	
	<!-- Bootstrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
	<!-- Link to Moment.js should go here -->
	<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
	<!-- Link to Firebase -->
	<script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script>


</head>

<body>
	<!-- Pseudo 01f: Check all links - bootstrap - Jumbotron -->
	<div class="container">

		<!-- Jumbotron -->
		<div class="jumbotron" style="background-color: black; color: white">

		<h3 class="text-center">Firebase Leaderboard Beta</h3>
		<h3 class="text-center">User Input Hard Code Skeleton Scenarios</h3>

		<!-- <div id="jq-check" class="panel-body">Container for JQ</div> -->
		<!-- <div id="js-check" class="panel-body">Container for JS</div> -->
		<!-- <div id="firebase-check" class="panel-body">Container for Firebase</div> -->

		<!-- <button id="submit" class="btn btn-primary">Set Firebase Object</button> -->

		</div>
		
		<div class="row">
			<div class="col-lg-12">
		
			<!-- Current Leaderboard -->
				<div class="panel panel-primary">
					<div class="panel-heading">

					</div>
					<div class="panel-body">
						<table class="table table-hover" id='leaderboardTable'>
							<thead>
								<tr>
									<th>Player Name</th>
									<th>Score</th>
								</tr>
							</thead>
							<tbody id="leaderboardBody">
								
							</tbody>
						</table>
					</div>
				</div>

				<!-- Add Player Result  -->
				<div class="panel panel-primary">
					<div class="panel-heading">
						<h3 class="panel-title"><strong>Add Player Result</strong></h3>
					</div>
					<div class="panel-body">
		

					<!-- Entry Form -->
					<form>

						<div class="form-group">
							<label for="">Player 1 Name</label>
							<input type="text" class="form-control" id="playerNameInput1" value="Kent">
						</div>

						<div class="form-group">
							<label for="">Score 1</label>
							<input type="number" class="form-control" id="scoreInput1" value="10">
						</div>

						<div class="form-group">
							<label for="">Player 2 Name</label>
							<input type="text" class="form-control" id="playerNameInput2" value="Omar">
						</div>

						<div class="form-group">
							<label for="">Score 2</label>
							<input type="number" class="form-control" id="scoreInput2" value="20">
						</div>

<!-- 						<button type="submit" class="btn btn-primary" id="set1a">Set1a</button>

						<button type="submit" class="btn btn-primary" id="set1b">Set1b</button>

						<button type="submit" class="btn btn-primary" id="push1a">Push1a</button>

						<button type="submit" class="btn btn-primary" id="update1a">Update1a</button>

						<button type="submit" class="btn btn-primary" id="update1b">Update1b</button> -->

						<button type="submit" class="btn btn-primary" id="sort1a">Sort1a</button>

<!-- 						<button type="submit" class="btn btn-primary" id="set2">Set2</button>
 -->
						<button type="submit" class="btn btn-primary" id="deleteall1">DeleteAll1</button>

					</form>

					</div>
				</div>

				<div class="panel panel-primary">
					<div class="panel-heading">
						<h3 class="panel-title"><strong>Codes</strong></h3>
					</div>
					<div class="panel-body">
						<p id="codeDisplay">What da hell</p>
					</div>
				</div>
			</div>
		</div>
	</div>


	<!-- Latest compiled and minified CSS & JS -->
	<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

	<!-- Link to javascript file -->
	<!-- <script src="https://www.gstatic.com/firebasejs/3.3.0/firebase.js"></script> -->
	<script type="text/javascript">

	// Pseudo 01: check all links
	// Pseudo 01a: check all links - jq - to be comment out
	// $("#jq-check").html("JQ CHECK");
	// Pseudo 01b: check all links - js - to be comment out
	// document.getElementById("js-check").innerHTML = "JS CHECK";


	// Initialize Firebase
	var config = {
	    apiKey: "AIzaSyCBIQ0gzyvDA8GRGDYMAQAO6Jq5tovTc6M",
	    authDomain: "fir-practice-efcb4.firebaseapp.com",
	    databaseURL: "https://fir-practice-efcb4.firebaseio.com",
	    storageBucket: "",
	};

	firebase.initializeApp(config);

	var database = firebase.database();

	// assign an array empty for sorting later
	var dbArray = [];

	// On webpage load, get a snapshot of all added object data and display them in descending order
	// to the empty leaderboard table
	database.ref().orderByChild('scoreInverse').on('child_added', function(snapshot){

		// assign variable for property snapshot
		playerName = snapshot.val().playerName;
		score = snapshot.val().score;

		// adding new table rows and displaying firebase data
		$("#leaderboardTable > tbody").append(
			"<tr><td>" + playerName + "</td><td>" + score + "</td></tr>"
		);

	});

	// This function when called will sort dbArray by the score, empty the leaderboard table
	// and add each object within the array to the leaderboard
	// function sortLeaderBoard(leaderBoard) {

	// 	// sort the array in the descending order by score property
	// 	var sortedLeaderBoard = dbArray.sort(function(a, b) {
	// 		return a.score - b.score;
	// 	});

	// 	// clear the leaderboard table
	// 	$('#leaderboardTable > tbody').empty();

	// 	// add each object in the array to the leaderboard table
	// 	sortedLeaderBoard.forEach(function(item) {
	// 		$("#leaderboardTable > tbody").append(
	// 			"<tr><td>" + item.playerName + "</td><td>" + item.score + "</td></tr>"
	// 		);			
	// 	});

	// 	console.log('sorted', sortedLeaderBoard);

	// };

	// This function when called will update the firebase with new player result call
	// the addPlayerResult function
	function updateLeaderBoard() {

		var playerName = $('#playerNameInput1').val().trim();
		var score = parseInt($('#scoreInput1').val().trim());

		database.ref(playerName).update({
			playerName : playerName,
			score : score,
			scoreInverse : -score
		}, function() {
			addPlayerResult(playerName, score)
		});

		console.log('updateLeaderBoard called')
	};


	function addPlayerResult(name, score) {

		var sorted = [];

		database.ref().orderByChild('scoreInverse').on('child_added', function(snapshot){

			playerName = snapshot.val().playerName;
			score = snapshot.val().score;

			sorted.push(snapshot.val())

		});	
		console.log(sorted, 'sorted')


		$('#leaderboardTable > tbody').empty()

		// adding new table rows and displaying each firebase object by the 2 properties
		sorted.forEach(function(item) {
			$("#leaderboardTable > tbody").append(
				"<tr><td>" + item.playerName + "</td><td>" + item.score + "</td></tr>"
			);			
		});
	}


	$('#sort1a').on('click', function(){

		//sortLeaderBoard(dbArray)
		updateLeaderBoard();

		return false;
	});




	// This is just a button to wipe firebase clean
	$('#deleteall1').on('click', function(){
		
		database.ref().remove();

		return false;

	});

	</script>


</body>

</html>


<!-- 
	database.ref().orderByChild('scoreInverse').on('child_added', function(childSnapshot, prevChildKey){

		var playerName = childSnapshot.val().playerName;
		var score = childSnapshot.val().score;

		$('#leaderboardTable > tbody').append(
			'<tr><td>' + playerName + '</td><td>' + score + '</td></tr>'
		);


	}); -->


<!-- 	// $('#update1a').on('click', function(){
	// 	update1a();
	// 	document.getElementById('codeDisplay').innerHTML = update1a;
	// 	return false;
	// });


	// function set1a(){

	// 	var playerName = $('#playerNameInput1').val().trim();
	// 	var score = parseInt($('#scoreInput1').val().trim());

	// 	database.ref().set({
	// 		players : {
	// 			playerName : playerName,
	// 			score : score,
	// 			scoreInverse : -score
	// 		}
	// 	});
	// };

	// $('#set1a').on('click', function(){
	// 	set1a();
	// 	document.getElementById('codeDisplay').innerHTML = set1a;
	// 	return false;
	// });

	// function set1b(){

	// 	var playerName = $('#playerNameInput1').val().trim();
	// 	var score = parseInt($('#scoreInput1').val().trim());

	// 	database.ref(playerName).set({
	// 		// players : {
	// 			// playerName : playerName,
	// 		score : score,
	// 		scoreInverse : -score
	// 		// }
	// 	});		
	// };

	// $('#set1b').on('click', function(){
	// 	set1b();
	// 	document.getElementById('codeDisplay').innerHTML = set1b;
	// 	return false;
	// });

	// function push1a(){

	// 	var playerName = $('#playerNameInput1').val().trim();
	// 	var score = parseInt($('#scoreInput1').val().trim());

	// 	database.ref().push({
	// 		playerName : playerName,
	// 		score : score,
	// 		scoreInverse : -score
	// 	});
	// };

	// $('#push1a').on('click', function(){
	// 	push1a();
	// 	document.getElementById('codeDisplay').innerHTML = push1a;
	// 	return false;
	// });

	// function update1b(){

	// 	var playerName = $('#playerNameInput1').val().trim();
	// 	var score = parseInt($('#scoreInput1').val().trim());
	// 	var playerKey = database.ref().child().key;
	// 		console.log(playerKey);

	// 	database.ref(playerKey).update({
	// 		score : score
	// 	});
	// };

	// $('#update1b').on('click', function(){
	// 	update1b();
	// 	document.getElementById('codeDisplay').innerHTML = update1b;
	// 	return false;
	// }); -->





<!-- // var arr = [
// 		{
// 			name: 'freddie',
// 			score: 3
// 		},
// 		{
// 			name: 'Kent',
// 			score: 2
// 		},
// 		{
// 			name: 'Elliot',
// 			score: 1
// 		}		
// 	];

			//console.log('firebase ref', database.ref());
			// Snapshot info
			//console.log('Object', snapshot.val()); -->





